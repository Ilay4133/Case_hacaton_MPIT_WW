import sqlite3
import flet as ft

def main(page: ft.Page):
    page.scroll = "always"
    page.title = "Междуреченск"
    page.theme_mode = "dark"
    page.bgcolor = "GREEN900"
    page.window.width = 350
    page.window.height = 650
    page.window.resizable = False
    page.update()
    global field_not
    field_not=""

    page.snack_bar = ft.SnackBar(
        content=ft.Text("Hello, world!"),
        action="Alright!",
    )

    db = sqlite3.connect('Users.data')
    cur = db.cursor()
    cur.execute("""CREATE TABLE IF NOT EXISTS Users ( 
            name TEXT PRIMARY KEY, 
            last_name TEXT,
            otchestvo TEXT,
            age INTEGER, 
            pol TEXT, 
            city TEXT)""")
    db.close()
    def snack_bar_open():
        page.snack_bar = ft.SnackBar(ft.Text("Вы не заполнили все поля"),bgcolor="GREEN700")
        page.snack_bar.open = True
        page.update()
    def registration(e):
        pol=""
        if name_field_reg.value=="":
            snack_bar_open()
        else:
            if pol_female_field_reg.value==True:
                pol="Мужской"
            elif pol_female_field_reg.value==True:
                pol="Женский"
            db = sqlite3.connect('Users.data')
            cur = db.cursor()
            cur.execute(f"INSERT INTO Users VALUES('{str(name_field_reg.value)}',"
                        f"'{str(last_name_field_reg.value)}','{str(otchestvo_field_reg.value)}',"
                        f"'{int(age_field_reg.value)}','{str(pol)}','{str(city_field_reg.value)}')")
            print("регистр копмл")
            db.commit()
            db.close()





    name_field_reg = ft.TextField(value="", hint_text="Имя", width=300)
    last_name_field_reg = ft.TextField(value="", hint_text="Фамилия", width=300)
    otchestvo_field_reg = ft.TextField(value="", hint_text="Отчество", width=300)
    age_field_reg = ft.TextField(value="", hint_text="Возраст", width=300)
    city_field_reg = ft.TextField(value="", hint_text="Город", width=300)
    pol_text_reg=ft.Text(value="Выберите пол")
    pol_female_field_reg = ft.Checkbox(label="Женский",value=True)
    pol_male_field_reg = ft.Checkbox(label="Мужской",value=True)
    reg_but=ft.ElevatedButton(text="Зарегистроваться", on_click=registration)
    page.reg_snackbar = ft.SnackBar(content=ft.Text(f"Вы не заполнили поле {field_not}"),action="alright")
    reg=ft.Column([name_field_reg,last_name_field_reg,otchestvo_field_reg,
                   age_field_reg,pol_text_reg,pol_male_field_reg,pol_female_field_reg,city_field_reg,
                   reg_but])
    reg_column=ft.Container(content=reg)
    page.add(reg_column)
    page.update()

ft.app(target=main)
